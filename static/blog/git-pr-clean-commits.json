{"title":"Cleaning up tag-along git commits in Pull Requests","description":"It's easy to submit dirty PRs with unnecessary number of stowaway commits. Learn how to clean this up.","date":"Dec 7, 2020 3:43 PM","published":true,"cover_image":"media/git-pr-clean-commits.jpg","body":"<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <figure style=\"width: 100%;padding-top: 66.25%;background-color: rgb(43, 46, 65)\">\n    <picture>\n      <source type=\"image/webp\" media=\"(min-width: 501px)\" data-srcset=\"media/git-pr-clean-commits/large.webp\">\n      <source type=\"image/webp\" media=\"(max-width: 500px)\" data-srcset=\"media/git-pr-clean-commits/small.webp\">\n      <source type=\"image/jpg\" media=\"(min-width: 501px)\" data-srcset=\"media/git-pr-clean-commits/large.jpg\">\n      <source type=\"image/jpg\" media=\"(max-width: 500px)\" data-srcset=\"media/git-pr-clean-commits/small.jpg\">\n      <img alt=\"Placeholder\" data-src=\"media/git-pr-clean-commits/large.jpg\" class=\"lazyload blog-img\">\n    </picture>\n  </figure>\n  </div><p></p>\n<p>Hey awesome dev! Are you on your way to make your next contribution to a repo? Great. Awesome! <img class=\"emoji\" draggable=\"false\" alt=\"ðŸ‘\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f44d.svg\"></p>\n<p>But when you make your Pull Request, you suddenly see something like this below <img class=\"emoji\" draggable=\"false\" alt=\"ðŸ‘‡\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f447.svg\"></p>\n<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <figure style=\"width: 100%;padding-top: 81.02564102564102%;background-color: rgb(217, 215, 215)\">\n    <picture>\n      <source type=\"image/webp\" media=\"(min-width: 501px)\" data-srcset=\"media/fork-ahead-upstream-header-image/large.webp\">\n      <source type=\"image/webp\" media=\"(max-width: 500px)\" data-srcset=\"media/fork-ahead-upstream-header-image/small.webp\">\n      <source type=\"image/png\" media=\"(min-width: 501px)\" data-srcset=\"media/fork-ahead-upstream-header-image/large.png\">\n      <source type=\"image/png\" media=\"(max-width: 500px)\" data-srcset=\"media/fork-ahead-upstream-header-image/small.png\">\n      <img alt=\"Placeholder\" data-src=\"media/fork-ahead-upstream-header-image/large.png\" class=\"lazyload blog-img\">\n    </picture>\n  </figure>\n  </div><p></p>\n<p>What is that?! How did it happen?!!</p>\n<p>Don't worry. Just read on.</p>\n<blockquote>\n<p>Disclaimer: I'm not a git expert in any way. In fact I started using it to its full extent only 2 months back from now, in <mark>November, 2020</mark>. The explanation you read below may be (partially)incorrect, and if you find that, please inform me with a Direct Message on twitter <a href=\"https://twitter.com/puruvj\" target=\"_blank\" rel=\"noopener\">@puruvj</a>. You'll be doing a favour to the whole community. However be assured, the commands/steps below are tested to work well, and are correct.</p>\n</blockquote>\n<h1 id=\"Explanation\"><a class=\"heading-link\" href=\"blog/git-pr-clean-commits#Explanation\">#</a>Explanation</h1>\n<p>It's easy to submit dirty Pull Requests with unnecessary number of commits, which shouldn't have been in there in the first place</p>\n<p>The photo you see above is of a PR I opened recently on an open source project I'm actively working on, <a href=\"https://github.com/twindle-co/twindle\" target=\"_blank\" rel=\"noopener\">Twindle</a>. I made only 2 commits related to this PR, but as you can see, this includes a lot of commits (19 to be exact). The thing is that it was 15 commits in the previous PR, and around 13 in the one before. As you can see, these commits are just adding on. The next PR I make would have all these included plus the new commits.</p>\n<p>There are 2 reasons why it happens:</p>\n<h2 id=\"Making-PRs-from-one-single-branch\"><a class=\"heading-link\" href=\"blog/git-pr-clean-commits#Making-PRs-from-one-single-branch\">#</a>Making PRs from one single branch</h2>\n<p>If you keep making PRs from one single branch, whether it be a new branch you created, or it be <code>main</code> or <code>master</code>, the previous commits will keep adding up, the files involved in each ones will keep piling up too.</p>\n<p>For example, you intended to make a PR with only 2 file changes, but your PR <strong>may</strong> show 10, or 20, or 30, or however number of files all those previous commits included.</p>\n<h2 id=\"Fault-in-our-stars-bots\"><a class=\"heading-link\" href=\"blog/git-pr-clean-commits#Fault-in-our-stars-bots\">#</a>Fault in our <s>stars</s> bots</h2>\n<p>As you see in the photo above <img class=\"emoji\" draggable=\"false\" alt=\"ðŸ‘†\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f446.svg\">, you will see some commits by a bot too. Some repos have automated bots to take care of some things. Sometimes when you merge changes from upstream repo(AKA The original repo from which you forked), some bot commits may be included, and will pollute your own commits history.</p>\n<blockquote>\n<p>If this explanation seems very incomplete or weird, is because of the fact that I don't know completely about these bot commits. Please do your own research about this if you can(and tell me too <img class=\"emoji\" draggable=\"false\" alt=\"ðŸ˜‹\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f60b.svg\">).</p>\n</blockquote>\n<h1 id=\"How-do-I-get-rid-of-these-stowaway-commit\"><a class=\"heading-link\" href=\"blog/git-pr-clean-commits#How-do-I-get-rid-of-these-stowaway-commit\">#</a>How do I get rid of these stowaway commit?</h1>\n<p>All you have to do is run these commands</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #A6ACCD\">git checkout main</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">git reset --hard upstream/main</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">git push --force</span></span>\n<span class=\"line\"></span></code></pre>\n<ol>\n<li>\n<p><code>git checkout main</code> just checkouts to your <code>main</code> branch. Replace it with <code>master</code> or whatever your default branch is.</p>\n</li>\n<li>\n<p><code>git reset --hard upstream/main</code> basically resets your own fork's commit history to that of the upstream's main branch. Replace <code>upstream/main</code> with <code>upstream/master</code> or <code>upstream/dev</code> or whatever that repo's default branch is, if needed.</p>\n</li>\n<li>\n<p><code>git push --force</code> basically pushes the new commit history to your own fork. <code>--force</code> is needed, cuz ideally, there won't be any files for git to push, so it will try to show your error.</p>\n</li>\n</ol>\n<h1 id=\"Caution\"><a class=\"heading-link\" href=\"blog/git-pr-clean-commits#Caution\">#</a>Caution</h1>\n<p>Hard reset may delete your local commits or any changes, so better not run this cleanup. Make your (dirty) PR, implore the maintainer to merge, and then do this process with your main branch.</p>\n","id":"git-pr-clean-commits","reading_time":1.7875,"toc":[{"indent":0,"id":"","title":"Explanation","length":11},{"indent":1,"id":"","title":"Making PRs from one single branch","length":33},{"indent":1,"id":"","title":"Fault in our stars bots","length":23},{"indent":0,"id":"","title":"How do I get rid of these stowaway commit?","length":42},{"indent":0,"id":"","title":"Caution","length":7}]}