{"title":"StencilJS Route Change events - Without any dependencies","description":"How to detect route changes in StencilJS Router using the core StencilJS APIs. No dependencies.","date":"3 June, 2020 01:46","cover_image":"../media/blog-social-intro.png","body":"<p>Hey Stencil user! Are you using the official <a href=\"https://github.com/ionic-team/stencil-router/wiki\" target=\"_blank\" rel=\"noopener\">StencilJS Router</a> and can't find how to detect route change events? Don't worry, my friend! You will find all the answers here.</p>\n<p>So, is there an <code>onRouteChange</code> event somewhere? Or something like <code>router.subscribe</code>?</p>\n<p>Nope. Its much simpler. Much much simpler, but for some reason, its not documented in the official Wiki (As of the time of writing), resulting in people using the <a href=\"https://ionicframework.com/docs/api/router\" target=\"_blank\" rel=\"noopener\"><code>ion-router</code></a> instead, where everything is very very well documented.</p>\n<p>I myself had to port an application from Stencil Router to Ion router just because of this very reason, and it was a total pain.</p>\n<p>But after some searching and experimenting, I figured it out (No not time travel, I ain't Tony Stark). And it was staring me in the face. It was that simple. Its built right into the very core of Stencil's architechture.</p>\n<h1 id=\"Solution\"><a class=\"heading-link\" href=\"/blog/stencil-router-events#Solution\">#</a>Solution</h1>\n<p>So here's your typical Stencil component.</p>\n<pre class=\"shiki\" style=\"background-color: #282c34\"><code><span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">Component</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">Prop</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">h</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">\"@stencil/core\"</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">@</span><span style=\"color: #61AFEF\">Component</span><span style=\"color: #ABB2BF\">({</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #E06C75\">tag</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #98C379\">\"my-first-component\"</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">})</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">export</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">class</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">MyComponent</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  @</span><span style=\"color: #61AFEF\">Prop</span><span style=\"color: #ABB2BF\">() </span><span style=\"color: #E06C75\">name</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">string</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #61AFEF\">render</span><span style=\"color: #ABB2BF\">() {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> &lt;</span><span style=\"color: #E06C75\">p</span><span style=\"color: #ABB2BF\">&gt;My name is </span><span style=\"color: #C678DD\">{</span><span style=\"color: #E5C07B\">this</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E06C75\">name</span><span style=\"color: #C678DD\">}</span><span style=\"color: #ABB2BF\">&lt;/</span><span style=\"color: #E06C75\">p</span><span style=\"color: #ABB2BF\">&gt;;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<p>This becomes</p>\n<pre class=\"shiki\" style=\"background-color: #282c34\"><code><span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">Component</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">Prop</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">h</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">Watch</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">\"@stencil/core\"</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">LocationSegments</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">injectHistory</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">\"@stencil/router\"</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">@</span><span style=\"color: #61AFEF\">Component</span><span style=\"color: #ABB2BF\">({</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #E06C75\">tag</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #98C379\">\"my-first-component\"</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">})</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">export</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">class</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">MyComponent</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  @</span><span style=\"color: #61AFEF\">Prop</span><span style=\"color: #ABB2BF\">() </span><span style=\"color: #E06C75\">name</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">string</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #7F848E\">/**</span></span>\n<span class=\"line\"><span style=\"color: #7F848E\">   * Remember, this should be `location only`</span></span>\n<span class=\"line\"><span style=\"color: #7F848E\">   */</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  @</span><span style=\"color: #61AFEF\">Prop</span><span style=\"color: #ABB2BF\">() </span><span style=\"color: #E06C75\">location</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">LocationSegments</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #7F848E\">/**</span></span>\n<span class=\"line\"><span style=\"color: #7F848E\">   * Now watch for any changes to the location property</span></span>\n<span class=\"line\"><span style=\"color: #7F848E\">   */</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  @</span><span style=\"color: #61AFEF\">Watch</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">\"location\"</span><span style=\"color: #ABB2BF\">) </span><span style=\"color: #61AFEF\">onRouteChange</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">newRoute</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">oldRoute</span><span style=\"color: #ABB2BF\">) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #7F848E\">// Do some epic shit</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #7F848E\">// Like changing document title or</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #7F848E\">// Route animations. Its your choice.</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #61AFEF\">render</span><span style=\"color: #ABB2BF\">() {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> &lt;</span><span style=\"color: #E06C75\">p</span><span style=\"color: #ABB2BF\">&gt;My name is </span><span style=\"color: #C678DD\">{</span><span style=\"color: #E5C07B\">this</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E06C75\">name</span><span style=\"color: #C678DD\">}</span><span style=\"color: #ABB2BF\">&lt;/</span><span style=\"color: #E06C75\">p</span><span style=\"color: #ABB2BF\">&gt;;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<p><strong>STOP!! It will still not work.</strong></p>\n<p>Yup this code will still not work. Let me explain why:</p>\n<p>The important bit here is the <code>location</code> prop. Think about it. Its a <strong>Prop</strong>. You pass a value to it. But here, nothing really is passing any value to our component here. Stencil certainly ain't.</p>\n<p>So, the solution is to have <em>something</em> pass a value to the <code>location</code> prop. Notice the <code>injectHistory</code> method we have imported but not used anywhere. Now's the time to use it. Just add this line at the very end of your file</p>\n<pre class=\"shiki\" style=\"background-color: #282c34\"><code><span class=\"line\"><span style=\"color: #61AFEF\">injectHistory</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">MyComponent</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"></span></code></pre>\n<p><code>MyComponent</code> is the name of the class declared above.</p>\n<p>So the final code becomes:</p>\n<pre class=\"shiki\" style=\"background-color: #282c34\"><code><span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">Component</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">Prop</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">h</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">Watch</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">\"@stencil/core\"</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">import</span><span style=\"color: #ABB2BF\"> { </span><span style=\"color: #E06C75\">LocationSegments</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">injectHistory</span><span style=\"color: #ABB2BF\"> } </span><span style=\"color: #C678DD\">from</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #98C379\">\"@stencil/router\"</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">@</span><span style=\"color: #61AFEF\">Component</span><span style=\"color: #ABB2BF\">({</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #E06C75\">tag</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #98C379\">\"my-first-component\"</span><span style=\"color: #ABB2BF\">,</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">})</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">export</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #C678DD\">class</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">MyComponent</span><span style=\"color: #ABB2BF\"> {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  @</span><span style=\"color: #61AFEF\">Prop</span><span style=\"color: #ABB2BF\">() </span><span style=\"color: #E06C75\">name</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">string</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #7F848E\">/**</span></span>\n<span class=\"line\"><span style=\"color: #7F848E\">   * Remember, this should be `location only`</span></span>\n<span class=\"line\"><span style=\"color: #7F848E\">   */</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  @</span><span style=\"color: #61AFEF\">Prop</span><span style=\"color: #ABB2BF\">() </span><span style=\"color: #E06C75\">location</span><span style=\"color: #ABB2BF\">: </span><span style=\"color: #E5C07B\">LocationSegments</span><span style=\"color: #ABB2BF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #7F848E\">/**</span></span>\n<span class=\"line\"><span style=\"color: #7F848E\">   * Now watch for any changes to the location property</span></span>\n<span class=\"line\"><span style=\"color: #7F848E\">   */</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  @</span><span style=\"color: #61AFEF\">Watch</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #98C379\">\"location\"</span><span style=\"color: #ABB2BF\">) </span><span style=\"color: #61AFEF\">onRouteChange</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">newRoute</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #E06C75\">oldRoute</span><span style=\"color: #ABB2BF\">) {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #7F848E\">// Do some epic shit</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #7F848E\">// Like changing document title or</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #7F848E\">// Route animations. Its your choice.</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  </span><span style=\"color: #61AFEF\">render</span><span style=\"color: #ABB2BF\">() {</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">    </span><span style=\"color: #C678DD\">return</span><span style=\"color: #ABB2BF\"> &lt;</span><span style=\"color: #E06C75\">p</span><span style=\"color: #ABB2BF\">&gt;My name is </span><span style=\"color: #C678DD\">{</span><span style=\"color: #E5C07B\">this</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #E06C75\">name</span><span style=\"color: #C678DD\">}</span><span style=\"color: #ABB2BF\">&lt;/</span><span style=\"color: #E06C75\">p</span><span style=\"color: #ABB2BF\">&gt;;</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">  }</span></span>\n<span class=\"line\"><span style=\"color: #ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">injectHistory</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #E06C75\">MyComponent</span><span style=\"color: #ABB2BF\">);</span></span>\n<span class=\"line\"></span></code></pre>\n<p>Here. Hope it helps. If you still run into issues, just ping me on Twitter. The link is in the footer.</p>\n<p>Goodbye and Enjoy!</p>\n","id":"stencil-router-events","reading_time":2.8375,"toc":[{"indent":0,"id":"","title":"Solution","length":8}]}