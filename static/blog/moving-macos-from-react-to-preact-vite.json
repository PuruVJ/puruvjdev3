{"title":"Moving React app to Preact <img class=\"emoji\" draggable=\"false\" alt=\"⚛\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/269b.svg\"/> in 10 minutes with Vite","description":"How I moved my 40+ components app from React to Preact in under 10 minutes","date":"9 Mar 2021","cover_image":"media/moving-from-react-to-preact-vite--always-has-been-meme.jpg","body":"<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <figure style=\"width: 100%;padding-top: 66.66666666666666%;background-color: rgb(188, 201, 225)\">\n    <picture>\n      <source type=\"image/webp\" media=\"(min-width: 501px)\" data-srcset=\"media/moving-from-react-to-preact-vite--cover/large.webp\">\n      <source type=\"image/webp\" media=\"(max-width: 500px)\" data-srcset=\"media/moving-from-react-to-preact-vite--cover/small.webp\">\n      <source type=\"image/jpg\" media=\"(min-width: 501px)\" data-srcset=\"media/moving-from-react-to-preact-vite--cover/large.jpg\">\n      <source type=\"image/jpg\" media=\"(max-width: 500px)\" data-srcset=\"media/moving-from-react-to-preact-vite--cover/small.jpg\">\n      <img alt=\"Placeholder\" data-src=\"media/moving-from-react-to-preact-vite--cover/large.jpg\" class=\"lazyload blog-img\">\n    </picture>\n  </figure>\n  </div><p></p>\n<p>Heya you awesome dev!!Glad to see ya here <img class=\"emoji\" draggable=\"false\" alt=\"🙂\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f642.svg\">. This post is just a recount of my experience when I moved a medium size React app(30+ components) to use Preact, in just <mark>10 minutes</mark>.</p>\n<h2 id=\"Is-it-true\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Is-it-true\">#</a>Is it true?</h2>\n<p>In case you are wondering if my claim of moving an app this big from one framework to other in just 10 minutes is true or just some clickbaity hoax, I assure you it isn't true. It didn't take 10 minutes for this.</p>\n<p>It took somewhere around <mark>8-9</mark> <img class=\"emoji\" draggable=\"false\" alt=\"😅\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f605.svg\"><img class=\"emoji\" draggable=\"false\" alt=\"😁\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f601.svg\"></p>\n<p>Yup. It took <strong>less than 10 minutes</strong> to move it. I put 10 minutes in the title b'coz humans love multiples of 10 a lot <img class=\"emoji\" draggable=\"false\" alt=\"😉\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f609.svg\"></p>\n<h1 id=\"What-is-this-app\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#What-is-this-app\">#</a>What is this app?</h1>\n<p>Alright, so the app in question is a fun side project I'm working on, <a href=\"https://macos.now.sh\" target=\"_blank\" rel=\"noopener\">macOS Web</a>, which is basically a MacOS Big Sur clone for Web(Don't tell Apple <img class=\"emoji\" draggable=\"false\" alt=\"🤫\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f92b.svg\">). As you can see in the screenshot below, it looks like MacOS Big Sur, just running in the browser.</p>\n<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <figure style=\"width: 100%;padding-top: 56.25%;background-color: rgb(209, 78, 97)\">\n    <picture>\n      <source type=\"image/webp\" media=\"(min-width: 501px)\" data-srcset=\"media/moving-from-react-to-preact-vite--macos-screenshot/large.webp\">\n      <source type=\"image/webp\" media=\"(max-width: 500px)\" data-srcset=\"media/moving-from-react-to-preact-vite--macos-screenshot/small.webp\">\n      <source type=\"image/png\" media=\"(min-width: 501px)\" data-srcset=\"media/moving-from-react-to-preact-vite--macos-screenshot/large.png\">\n      <source type=\"image/png\" media=\"(max-width: 500px)\" data-srcset=\"media/moving-from-react-to-preact-vite--macos-screenshot/small.png\">\n      <img alt=\"Placeholder\" data-src=\"media/moving-from-react-to-preact-vite--macos-screenshot/large.png\" class=\"lazyload blog-img\">\n    </picture>\n  </figure>\n  </div><p></p>\n<p>I started making it in <mark>React</mark> and <mark>Snowpack</mark> (Think of it as Webpack that does everything you want it do, without telling it anything) boilerplate, then around 2 weeks back, I moved it from <mark>Snowpack</mark> to <mark>Vite</mark> (Similar to Snowpack, just more refined and with more features.), and got some really cool features out of it.</p>\n<p>Then just a few days ago, I tried an experiment to move it to Preact. I treat this project as a playground of sorts and am constantly stirring things up in it. I just made a new branch, and started fooling around. And surprisingly, this whole moving took less than 10 minutes.</p>\n<h1 id=\"Process\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Process\">#</a>Process</h1>\n<p>Here's a brief breakdown of the whole process.</p>\n<h2 id=\"Installing-right-dependencies\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Installing-right-dependencies\">#</a>Installing right dependencies</h2>\n<p>This is parts of my <code>package.json</code> file before the transfer:</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C792EA\">dependencies</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFCB6B\">react</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">^17.0.0</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFCB6B\">react-dom</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">^17.0.0</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">},</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C792EA\">devDependencies</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFCB6B\">@types/react</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">^17.0.0</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFCB6B\">@types/react-dom</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">^17.0.0</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFCB6B\">@vitejs/plugin-react-refresh</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">^1.3.1</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFCB6B\">vite</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">^2.0.5</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<p>As you can see, we have <code>react</code> and <code>react-dom</code> as dependencies, their respective TypeScript Typings as <code>devDependencies</code>, along with <code>vite</code> itself, and lastly the special package <code>@vitejs/plugin-react-refresh</code>. This last package is responsible for the <mark>Hot Module Reload</mark> magic of Vite with React.</p>\n<blockquote>\n<p>Note: The package.json above contains only the relevant code for this article. There are over 20 dependencies in the actual project.</p>\n</blockquote>\n<p>So how do we move to Preact then? The answer lies in looking at the <mark>preact-ts</mark>(Preact starter with TypeScript) starter template of vite, and the only content here was <img class=\"emoji\" draggable=\"false\" alt=\"👇\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f447.svg\"></p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C792EA\">dependencies</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFCB6B\">preact</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">^10.5.9</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">},</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C792EA\">devDependencies</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFCB6B\">@prefresh/vite</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">^2.0.0</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFCB6B\">vite</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">^2.0.5</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<p>Whoa!! That was drastic!! Notice that there's no <code>preact-dom</code> here, as <code>preact</code> has all the DOM stuff built in. Plus we have a different package <mark>@prefresh/vite</mark>. This I gathered was the HMR module for Preact with Vite.</p>\n<p>So all I did was delete the <code>react</code> related packages, and installed these 2 packages(<code>preact</code> and <code>@prefresh/vite</code>).</p>\n<blockquote>\n<p>Why no <code>@types/preact</code>?</p>\n<p>Well, We needed <code>@types/react</code> because React doesn't ship its own Typings, which can make DX feel like shooting in the dark, so the community has kindly provided types themselves for it. <br>\nBut preact is a different story. It ships its own TypeScript typings, so we don't need any extra packages. It's just awesome that way <img class=\"emoji\" draggable=\"false\" alt=\"😍\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f60d.svg\">.</p>\n</blockquote>\n<h2 id=\"Modifying-vite.config.ts\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Modifying-vite.config.ts\">#</a>Modifying vite.config.ts</h2>\n<p>The <code>vite.config.ts</code> with React <img class=\"emoji\" draggable=\"false\" alt=\"👇\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f447.svg\"></p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">defineConfig</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">vite</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #A6ACCD\"> reactRefresh </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">@vitejs/plugin-react-refresh</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95\">// https://vitejs.dev/config/</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">export</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">default</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">defineConfig</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">plugins</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> [</span><span style=\"color: #82AAFF\">reactRefresh</span><span style=\"color: #A6ACCD\">()]</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">esbuild</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #F07178\">jsxInject</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">import React from 'react'</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">},</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span></code></pre>\n<p>And the new config is:</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">defineConfig</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">vite</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #A6ACCD\"> prefresh </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">@prefresh/vite</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95\">// https://vitejs.dev/config/</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">export</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">default</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">defineConfig</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">esbuild</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #F07178\">jsxFactory</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">h</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #F07178\">jsxFragment</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">Fragment</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #F07178\">jsxInject</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">import { h, Fragment } from 'preact'</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">},</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">plugins</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> [</span><span style=\"color: #82AAFF\">prefresh</span><span style=\"color: #A6ACCD\">()]</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">alias</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #F07178\">react</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">preact/compat</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">},</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span></code></pre>\n<ol>\n<li>\n<p>Notice the <code>esbuild</code> property. Vite is built on top this super fast ES module bundler <code>esbuild</code>, here we are passing some options to it. <code>jsxFactory</code> and <code>jsxFragment</code> are exactly what they look like. The <code>jsxInject</code> here is a very <img class=\"emoji\" draggable=\"false\" alt=\"✨\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/2728.svg\">magical<img class=\"emoji\" draggable=\"false\" alt=\"✨\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/2728.svg\"> property, that automatically puts the statement passed to it in every single file, so it saves you the trouble of importing <code>h</code> from preact in every single file, or <code>React</code> for a <code>react</code> app. And during the production build, vite strips out unnecessary imports, so files not needing preact will end up with no preact at all. So no harm is done ultimately.</p>\n</li>\n<li>\n<p>In the <code>plugins</code> property, I have replaced <code>reactRefresh</code> with <code>prefresh</code>, and now our app supports HMR for preact.</p>\n</li>\n<li>\n<p>Lastly, <code>alias</code> is the most, <strong>MOST</strong> important property here. In this project, I'm using 15+ packages that import directly from <code>React</code>, and moving to preact would have broken them completely. So the alias property accepts a key value pair. In this case, I'm pointing <code>react</code> to <code>preact/compat</code>, which is <code>preact</code>'s compatibility layer to work with existing react apps.</p>\n</li>\n</ol>\n<h2 id=\"Fix-tsconfig.json\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Fix-tsconfig.json\">#</a>Fix tsconfig.json</h2>\n<p>We are using TypeScript with React, and we have to tell it that the JSX factory and fragments are now different, so let's do that small change.</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  ...</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C792EA\">jsx</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">preserve</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C792EA\">jsxFactory</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">h</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C792EA\">jsxFragmentFactory</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">Fragment</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  ...</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<h2 id=\"Modify-index.tsx\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Modify-index.tsx\">#</a>Modify index.tsx</h2>\n<p>The entrypoint of our app is the <code>index.tsx</code> app, which would need some modification to work with preact. Luckily the changes needed are <strong>tiny</strong>.</p>\n<p>The code before <img class=\"emoji\" draggable=\"false\" alt=\"👇\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f447.svg\"></p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #A6ACCD\"> ReactDOM </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">react-dom</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">Desktop</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">./views/desktop/Desktop</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">ReactDOM</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">render</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">Desktop</span><span style=\"color: #89DDFF\"> /&gt;,</span><span style=\"color: #A6ACCD\"> document</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getElementById</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">root</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #A6ACCD\">))</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span></code></pre>\n<p>Here we are doing a <code>ReactDOM.render</code>. But preact itself has a <code>render</code> method. SO let's swap it out with.</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">render</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">preact</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">import</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">Desktop</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">from</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">./views/desktop/Desktop</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">render</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #FFCB6B\">Desktop</span><span style=\"color: #89DDFF\"> /&gt;,</span><span style=\"color: #A6ACCD\"> document</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getElementById</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">root</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #A6ACCD\">))</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span></code></pre>\n<p>And BAM!! That's it. Only these 4 files needed to be changed. And this is how it all happened in less than 10 minutes.</p>\n<h1 id=\"Results\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Results\">#</a>Results</h1>\n<p>Let's talk business. What benefits did I get out of this weird, eccentric wish to move a whole codebase from one framework to another?</p>\n<h2 id=\"No-need-to-change-imports\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#No-need-to-change-imports\">#</a>No need to change imports</h2>\n<p>There are over 30+ files that import something from <code>react</code>. And even now, they're importing from <code>react</code>. Only difference is that its actually <code>preact/compat</code> underneath. I didn't have to go and change every single import.</p>\n<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <figure style=\"width: 100%;padding-top: 56.19369369369369%;background-color: rgb(12, 12, 17)\">\n    <picture>\n      <source type=\"image/webp\" media=\"(min-width: 501px)\" data-srcset=\"media/moving-from-react-to-preact-vite--always-has-been-meme/large.webp\">\n      <source type=\"image/webp\" media=\"(max-width: 500px)\" data-srcset=\"media/moving-from-react-to-preact-vite--always-has-been-meme/small.webp\">\n      <source type=\"image/jpg\" media=\"(min-width: 501px)\" data-srcset=\"media/moving-from-react-to-preact-vite--always-has-been-meme/large.jpg\">\n      <source type=\"image/jpg\" media=\"(max-width: 500px)\" data-srcset=\"media/moving-from-react-to-preact-vite--always-has-been-meme/small.jpg\">\n      <img alt=\"Placeholder\" data-src=\"media/moving-from-react-to-preact-vite--always-has-been-meme/large.jpg\" class=\"lazyload blog-img\">\n    </picture>\n  </figure>\n  </div><p></p>\n<h2 id=\"Reduced-bundle-size\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Reduced-bundle-size\">#</a>Reduced bundle size</h2>\n<p><code>react</code> alone isn't everything. It needs to be paired up with <code>react-dom</code>, to actually render stuff on web. Both of these combined weigh <mark>129KB</mark> minified, and <mark>42.4KB</mark> min+gzip. That's not much really, but I'm a bundle size freak. I want as less size as possible.</p>\n<p>Moving to preact did that for me. <code>preact</code> is just <mark>4KB</mark> min+gzip. 90% smaller!<img class=\"emoji\" draggable=\"false\" alt=\"🤯\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f92f.svg\"><img class=\"emoji\" draggable=\"false\" alt=\"🤯\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f92f.svg\">. Quite miraculous, right?</p>\n<h2 id=\"Runtime-performance\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Runtime-performance\">#</a>Runtime performance</h2>\n<p>Oh boy, this one is very very interesting.</p>\n<p>You see, first I heard of preact was 3 years ago. I found out this 3KB alternative to React, and I quite liked the concept. I also read in some article that its runtime performance was much better. I didn't care at the time, because really, browsers are amazingly fast, and runtime perf didn't matter to me much. So I never cared about it.</p>\n<p>But in macOS Web, I realized I desperately needed better runtime performance because of some very janky animations in it. The whole app was very laggy. This was one of the motivations of switching to preact.</p>\n<p>So when I was done moving the app, and fired up the dev server, my jaw dropped to the floor.</p>\n<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <div class=\"gif-vid-container\">\n    <video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n      <source src=\"/media/moving-from-react-to-preact-vite--jaw-drop/vidgif.mp4\" type=\"video/mp4\">\n      Your browser doesn't support HTML5 video playback. <a href=\"/media/moving-from-react-to-preact-vite--jaw-drop.gif\" target=\"_blank\" rel=\"noopener\">See the gif here</a>\n    </video>\n  </div>\n  </div><p></p>\n<p>All the jank was gone!! Literally <strong>GONE</strong>. Just vanished in thin air. When I hovered over the dock, perfectly smooth. When I open menus, perfectly smooth. When I switched between light and dark themes, perfectly smooth.</p>\n<p>You can try it out yourself. (Better you view them on desktop)</p>\n<p>React version <img class=\"emoji\" draggable=\"false\" alt=\"👉\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f449.svg\"> <a href=\"https://macos-web-fyri0fstj-puruvj.vercel.app/\" target=\"_blank\" rel=\"noopener\">macos-web-fyri0fstj-puruvj.vercel.app</a> <br>\nPreact version <img class=\"emoji\" draggable=\"false\" alt=\"👉\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f449.svg\"> <a href=\"https://macos.now.sh\" target=\"_blank\" rel=\"noopener\">macos.now.sh</a></p>\n<p>See for yourself which is smoother.</p>\n<h1 id=\"Unsung-hero\"><a class=\"heading-link\" href=\"blog/moving-macos-from-react-to-preact-vite#Unsung-hero\">#</a>Unsung hero</h1>\n<p>Until now I've been singing about Preact, but the true hero of the story is <mark>Vite</mark>. Look back into the section where I'm installing the dependencies. There's only 1 needed devDependency needed there, <code>vite</code>. <code>vite</code> does everything for you under the hood. It transpiles typescript without any unneeded packages, it transforms JSX into JS readable format, it minifies the crap out of the bundles, it supports all kind of pre-processors, and it does all that without you telling it to do that.</p>\n<p>If I had initialized this app with <code>create-react-app</code>, which is kind of the standard, this migration wouldn't have been possible, as it would take a lot of time and lots of banging your head against the wall.</p>\n<p><img src=\"\" alt=\"\" class=\"feature-image\" style=\"display: none;\"></p><div class=\"picture-container\">\n  <div class=\"gif-vid-container\">\n    <video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n      <source src=\"/media/moving-from-react-to-preact-vite--banging-head/vidgif.mp4\" type=\"video/mp4\">\n      Your browser doesn't support HTML5 video playback. <a href=\"/media/moving-from-react-to-preact-vite--banging-head.gif\" target=\"_blank\" rel=\"noopener\">See the gif here</a>\n    </video>\n  </div>\n  </div><p></p>\n<p>But with vite, it was easy as <code>npm install preact</code> and changing <code>index.tsx</code> to use <code>preact</code> instead of <code>react</code>.</p>\n<p>Vite is very amazing, and very versatile. I'm very much in love with it and have no intention of moving away from it anytime soon.</p>\n<p>And if you're skeptical about it, Vite is created by the creator of VueJS, <a href=\"https://twitter.com/youyuxi\" target=\"_blank\" rel=\"noopener\">Evan You</a>. And its not just for Vue, it's very much framework agnostic. You can use it with any framework(React, Preact, Vue, lit-element, and more. Heck even the next version of svelte is going to be based on Vite itself).</p>\n<p>So I really invite you to check Vite out sometime. It's like a breath of fresh air. <a href=\"https://vitejs.dev/\" target=\"_blank\" rel=\"noopener\">Vite Homepage</a></p>\n<p>I hope you got something good out of this article <img class=\"emoji\" draggable=\"false\" alt=\"😉\" src=\"https://twemoji.maxcdn.com/v/13.0.2/svg/1f609.svg\">.</p>\n<p>Signing off!</p>\n","id":"moving-macos-from-react-to-preact-vite","reading_time":6.8075,"toc":[{"indent":1,"id":"","title":"Is it true?","length":11},{"indent":0,"id":"","title":"What is this app?","length":17},{"indent":0,"id":"","title":"Process","length":7},{"indent":1,"id":"","title":"Installing right dependencies","length":29},{"indent":1,"id":"","title":"Modifying vite.config.ts","length":24},{"indent":1,"id":"","title":"Fix tsconfig.json","length":17},{"indent":1,"id":"","title":"Modify index.tsx","length":16},{"indent":0,"id":"","title":"Results","length":7},{"indent":1,"id":"","title":"No need to change imports","length":25},{"indent":1,"id":"","title":"Reduced bundle size","length":19},{"indent":1,"id":"","title":"Runtime performance","length":19},{"indent":0,"id":"","title":"Unsung hero","length":11}]}