{"title":"Performantly loading Google Fonts based on Data Saver","description":"Efficiently and Asynchronously load Google Fonts based on Data Saver mode","date":"5 June, 2020 10:30","cover_image":"media/blog-social-intro.png","body":"<p>You. Yes you, who is loading a 50-100kbs of fonts on your site, drop them. Use Comic Sans instead.</p>\n<p>Just Kidding. Use as many fonts as you need. I am myself loading 60kb of fonts on this very blog page, just a little more efficiently than the default approach.</p>\n<h1 id=\"Problem\"><a class=\"heading-link\" href=\"blog/google-fonts-prefetch#Problem\">#</a>Problem</h1>\n<p>Using custom fonts isn't bad. They make a bold brand statement. Imagine Google's logo without its beautiful geometric font or Medium without its classic font.</p>\n<p>Nowadays, advice like <mark>Don't use fonts</mark> is just impractical. Sure, <mark>Use less fonts</mark> is a good, but the prebuilt system fonts are just hideous(Looking at you, Ariel) and reading content in those is just not as appealing as it was a decade ago.</p>\n<p>But, if you look at stats, the average website uses about <mark> 50 - 70 KiloBytes</mark> of fonts nowadays. For scale, this blog you're reading, without images, is a total of 78KB, out of which the fonts take up 60kb. We are using way too much fonts nowadays, but it can't really be helped.</p>\n<p>So we have to figure out ways to not let the loading time of fonts get in the way of User experience, while at the same time, respecting the user's data plan. In US, 60KB is basically dust, whereas in countries like Nigeria and India, 60KB can be <strong>real</strong> money.</p>\n<h1 id=\"Solution\"><a class=\"heading-link\" href=\"blog/google-fonts-prefetch#Solution\">#</a>Solution</h1>\n<p>We are going to use the amazing resource hint tag.</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">link</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">rel</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">prefetch</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\"> </span><span style=\"color: #C792EA\">href</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">URL</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #89DDFF\"> /&gt;</span></span>\n<span class=\"line\"></span></code></pre>\n<p>This tag simply loads the given URL and stores it in cache/memory until it is actually used. This loading happens asynchronously and doesn't delay the page's loading.</p>\n<p>In simple terms adding this tag to a page will not make it any slower than before.</p>\n<p>The important bit here:</p>\n<blockquote>\n<p>If the browser's data saver is on, this tag will be ignored, thus saving that additional request.</p>\n</blockquote>\n<p><a href=\"https://medium.com/reloading/preload-prefetch-and-priorities-in-chrome-776165961bbf\" target=\"_blank\" rel=\"noopener\">Read more about Resource Hints</a></p>\n<p>Let's say that our fonts' URL is:</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #A6ACCD\">https://fonts.googleapis.com/css?family=Comfortaa|Fira+Code|Quicksand&amp;display=swap</span></span>\n<span class=\"line\"></span></code></pre>\n<p>Instead of loading them the standard way</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">link</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #C792EA\">rel</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">stylesheet</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #C792EA\">href</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">https://fonts.googleapis.com/css?family=Comfortaa|Fira+Code|Quicksand&amp;display=swap</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">/&gt;</span></span>\n<span class=\"line\"></span></code></pre>\n<p>We do it like this</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">link</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #C792EA\">rel</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">prefetch</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #C792EA\">href</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">https://fonts.googleapis.com/css?family=Comfortaa|Fira+Code|Quicksand&amp;display=swap</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #C792EA\">as</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">style</span><span style=\"color: #89DDFF\">\"</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #C792EA\">onload</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"this.</span><span style=\"color: #A6ACCD\">onload</span><span style=\"color: #89DDFF\">=null;this.</span><span style=\"color: #A6ACCD\">rel</span><span style=\"color: #89DDFF\">='</span><span style=\"color: #C3E88D\">stylesheet</span><span style=\"color: #89DDFF\">'\"</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #C792EA\">onerror</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"this.</span><span style=\"color: #A6ACCD\">onerror</span><span style=\"color: #89DDFF\">=null;this.</span><span style=\"color: #A6ACCD\">rel</span><span style=\"color: #89DDFF\">='</span><span style=\"color: #C3E88D\">stylesheet</span><span style=\"color: #89DDFF\">'\"</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">/&gt;</span></span>\n<span class=\"line\"></span></code></pre>\n<p>This code above is doing multiple good things at once. The <code>onload</code> will fire when the resource has fully loaded, and replace the <code>rel=prefetch</code> with <code>rel=stylesheet</code>, making the effects of the fonts active.</p>\n<p>But another thing is happening here.</p>\n<blockquote>\n<p>If somehow, due to poor connectivity, the request fails, the <code>onerror</code> will try <strong>again</strong> to load the resource. This solution kills 2 birds with one bullet(proverbially only, off course)</p>\n</blockquote>\n<h1 id=\"Downsides\"><a class=\"heading-link\" href=\"blog/google-fonts-prefetch#Downsides\">#</a>Downsides</h1>\n<ul>\n<li>Doesn't load the fonts if old browser or (at the time of writing) latest Safari.</li>\n<li>Slightly degrades the experience for data saver users, but honestly, people are on a site because of the content primarily. Besides, if they have data saver on, this means their data speeds are very slow and data plans quite expensive. They will thank you for making a fast loading site.</li>\n</ul>\n<p><em>That's it for today. Hope you liked the article. Ping me on Twitter if you have any problems or simply leave a review. Link is in the footer.</em></p>\n","id":"google-fonts-prefetch","reading_time":1.755,"toc":[{"indent":0,"id":"","title":"Problem","length":7},{"indent":0,"id":"","title":"Solution","length":8},{"indent":0,"id":"","title":"Downsides","length":9}]}